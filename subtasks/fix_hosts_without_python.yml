---
- name: Perform a dirty OS detection if python is not installed
  raw: |
    if which python > /dev/null || which python3 > /dev/null; then
      echo installed
    else
      sed -n 's/^NAME="\([^"]*\)"/\1/p' /etc/os-release
    fi
  changed_when: false
  register: dirty_detect

- name: Print message when already installed
  debug:
    msg: Host {{ inventory_hostname }} already has python. Next will skip.
  when: dirty_detect.stdout_lines[0] == 'installed'

- name: Install python on openbsd if needed
  raw: |
    pkg_add -r python%3
  become: yes
  when: dirty_detect.stdout_lines[0] == 'OpenBSD'

- name: Install python on Ubuntu if needed
  raw: |
    apt install -y python3
  become: yes
  when: dirty_detect.stdout_lines[0] == 'Ubuntu'
